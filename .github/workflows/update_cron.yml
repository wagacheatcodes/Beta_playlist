name: Update VOD Data

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  generate-json:
    runs-on: ubuntu-latest
    timeout-minutes: 350

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Dependencies
        run: |
          pip install requests

      # -----------------------------------------------------------
      # 1. Run Movies Script in correct folder
      # -----------------------------------------------------------
      - name: Run Movies Generator
        run: python movies_runner.py
        working-directory: Beta/scripts

      # -----------------------------------------------------------
      # 2. Run Series Script in correct folder
      # -----------------------------------------------------------
      - name: Run Series Generator
        run: python series_runner.py
        working-directory: Beta/scripts

      # -----------------------------------------------------------
      # 3. Save Data (Commit & Push)
      # -----------------------------------------------------------
      - name: Commit and Push Changes
        run: |
          echo "Configuring Git..."
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # Stage the 'dist' folder found inside 'Beta/scripts'
          git add Beta/scripts/dist/
          
          # Check for changes
          if [ -n "$(git status --porcelain)" ]; then
            echo "Changes detected. Committing..."
            
            # Commit locally first to fix the "unstaged changes" error
            git commit -m "Update VOD Data [skip ci]"
            
            # Pull updates (Rebase) then Push
            git pull --rebase origin main
            git push origin main
            echo "Success! Data pushed."
          else
            echo "No changes detected."
          fi
